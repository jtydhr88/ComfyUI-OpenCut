"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6912],{76912:(e,t,a)=>{a.r(t),a.d(t,{default:()=>B});var l=a(92737),i=a(20713),s=a(86568),r=a(9403),n=a(22917),o=a(44390),d=a(89138),u=a(71990),c=a(29712),v=a(86763),p=a(28664),f=a(3850),m=a(16098),g=a(77644),_=(e=>(e.CREDIT_ADDED="credit_added",e.ACCOUNT_CREATED="account_created",e.API_USAGE_STARTED="api_usage_started",e.API_USAGE_COMPLETED="api_usage_completed",e))(_||{});let y=p.a8.create({baseURL:p.a9,headers:{"Content-Type":"application/json"}}),h={key:0,class:"flex items-center justify-center p-8"},b={key:1,class:"p-4"},k={class:"event-details"},A={key:0,class:"text-green-500 font-semibold"},R={key:1},x={key:2,class:"flex flex-col gap-1"},E={class:"font-semibold"},C={class:"text-sm text-gray-400"},w=(0,i.pM)({__name:"UsageLogsTable",setup(e,{expose:t}){let a=(0,l.KR)([]),d=(0,l.KR)(!0),u=(0,l.KR)(null),c=(()=>{let e=(0,l.KR)(!1),t=(0,l.KR)(null),{d:a}=(0,v.s9)(),i=async(a,l)=>{let{errorContext:i,routeSpecificErrors:s}=l;e.value=!0,t.value=null;try{return(await a()).data}catch(e){return((e,a,l)=>{var i,s,r;let n;if(!(0,p.ab)(e)){if(p.a8.isAxiosError(e)){let t=null==(i=e.response)?void 0:i.status;n=t&&(null==l?void 0:l[t])?l[t]:(null==(r=null==(s=e.response)?void 0:s.data)?void 0:r.message)??`${a} failed with status ${t}`}else n=`${a} failed: ${e instanceof Error?e.message:String(e)}`;t.value=n}})(e,i,s),null}finally{e.value=!1}};function s(e){return e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function r(e){return"number"==typeof e?e.toLocaleString():"string"==typeof e&&e.match(/^\d{4}-\d{2}-\d{2}/)?new Date(e).toLocaleString():e}async function n({page:e=1,limit:a=10}={}){let l=await (0,p.aa)().getAuthHeader();return l?i(()=>y.get("/customers/events",{params:{page:e,limit:a},headers:l}),{errorContext:"Fetching customer events",routeSpecificErrors:{400:"Invalid input, object invalid",404:"Not found"}}):(t.value="Authentication header is missing",null)}return{isLoading:e,error:t,getMyEvents:n,formatEventType:function(e){switch(e){case"credit_added":return"Credits Added";case"account_created":return"Account Created";case"api_usage_completed":return"API Usage";default:return e}},getEventSeverity:function(e){switch(e){case"credit_added":return"success";case"account_created":default:return"info";case"api_usage_completed":return"warning"}},formatAmount:function(e){return e?(e/100).toFixed(2):"0.00"},hasAdditionalInfo:function(e){let{amount:t,api_name:a,model:l,...i}=e.params||{};return Object.keys(i).length>0},formatDate:function(e){return a(new Date(e),{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},formatJsonKey:s,formatJsonValue:r,getTooltipContent:function(e){let{...t}=e.params||{};return Object.entries(t).map(([e,t])=>{let a=s(e),l=r(t);return`<strong>${a}:</strong> ${l}`}).join("<br>")}}})(),w=(0,l.KR)({page:1,limit:7,total:0,totalPages:0}),$=(0,i.EW)(()=>(w.value.page-1)*w.value.limit),L=(0,i.EW)(()=>{let e=new Map;return a.value.forEach(t=>{c.hasAdditionalInfo(t)&&t.event_id&&e.set(t.event_id,c.getTooltipContent(t))}),e}),T=async()=>{d.value=!0,u.value=null;try{let e=await c.getMyEvents({page:w.value.page,limit:w.value.limit});e?(e.events&&(a.value=e.events),e.page&&(w.value.page=e.page),e.limit&&(w.value.limit=e.limit),e.total&&(w.value.total=e.total),e.totalPages&&(w.value.totalPages=e.totalPages)):u.value=c.error.value||"Failed to load events"}catch(e){u.value=e instanceof Error?e.message:"Unknown error",console.error("Error loading events:",e)}finally{d.value=!1}},F=e=>{w.value.page=e.page+1,T().catch(e=>{console.error("Error loading events:",e)})};return t({refresh:async()=>{w.value.page=1,await T()}}),(e,t)=>{let v=(0,i.gN)("tooltip");return(0,i.uX)(),(0,i.CE)("div",null,[d.value?((0,i.uX)(),(0,i.CE)("div",h,[(0,i.bF)((0,l.R1)(g.A))])):u.value?((0,i.uX)(),(0,i.CE)("div",b,[(0,i.bF)((0,l.R1)(m.A),{severity:"error",closable:!1},{default:(0,i.k6)(()=>[(0,i.eW)((0,s.v_)(u.value),1)]),_:1})])):((0,i.uX)(),(0,i.Wv)((0,l.R1)(o.A),{key:2,value:a.value,paginator:!0,rows:w.value.limit,"total-records":w.value.total,first:$.value,lazy:!0,class:"p-datatable-sm custom-datatable",onPage:F},{default:(0,i.k6)(()=>[(0,i.bF)((0,l.R1)(n.A),{field:"event_type",header:e.$t("credits.eventType")},{body:(0,i.k6)(({data:e})=>[(0,i.bF)((0,l.R1)(f.A),{value:(0,l.R1)(c).formatEventType(e.event_type),severity:(0,l.R1)(c).getEventSeverity(e.event_type)},null,8,["value","severity"])]),_:1},8,["header"]),(0,i.bF)((0,l.R1)(n.A),{field:"details",header:e.$t("credits.details")},{body:(0,i.k6)(({data:t})=>{var a,r,n;return[(0,i.Lk)("div",k,[t.event_type===(0,l.R1)(_).CREDIT_ADDED?((0,i.uX)(),(0,i.CE)("div",A,(0,s.v_)(e.$t("credits.added"))+" $"+(0,s.v_)((0,l.R1)(c).formatAmount(null==(a=t.params)?void 0:a.amount)),1)):t.event_type===(0,l.R1)(_).ACCOUNT_CREATED?((0,i.uX)(),(0,i.CE)("div",R,(0,s.v_)(e.$t("credits.accountInitialized")),1)):t.event_type===(0,l.R1)(_).API_USAGE_COMPLETED?((0,i.uX)(),(0,i.CE)("div",x,[(0,i.Lk)("div",E,(0,s.v_)((null==(r=t.params)?void 0:r.api_name)||"API"),1),(0,i.Lk)("div",C,(0,s.v_)(e.$t("credits.model"))+": "+(0,s.v_)((null==(n=t.params)?void 0:n.model)||"-"),1)])):(0,i.Q3)("",!0)])]}),_:1},8,["header"]),(0,i.bF)((0,l.R1)(n.A),{field:"createdAt",header:e.$t("credits.time")},{body:(0,i.k6)(({data:e})=>[(0,i.eW)((0,s.v_)((0,l.R1)(c).formatDate(e.createdAt)),1)]),_:1},8,["header"]),(0,i.bF)((0,l.R1)(n.A),{field:"params",header:e.$t("credits.additionalInfo")},{body:(0,i.k6)(({data:e})=>[(0,l.R1)(c).hasAdditionalInfo(e)?(0,i.bo)(((0,i.uX)(),(0,i.Wv)((0,l.R1)(r.A),{key:0,icon:"pi pi-info-circle",class:"p-button-text p-button-sm"},null,512)),[[v,{escape:!1,value:L.value.get(e.event_id)||"",pt:{text:{style:{width:"max-content !important"}}}},void 0,{top:!0}]]):(0,i.Q3)("",!0)]),_:1},8,["header"])]),_:1},8,["value","rows","total-records","first"]))])}}}),$={class:"flex flex-col h-full"},L={class:"text-2xl font-bold mb-2"},T={class:"flex flex-col gap-2"},F={class:"text-sm font-medium text-muted"},D={class:"flex justify-between items-center"},S={class:"flex flex-row items-center"},P={key:1,class:"text-xs text-muted"},U={class:"flex justify-between items-center"},I={key:0,class:"flex-grow"},W={class:"text-sm font-medium"},X={class:"text-xs text-muted"},j={class:"flex flex-row gap-2"},B=(0,i.pM)({__name:"CreditsPanel",setup(e){let{t}=(0,v.s9)(),a=(0,p.h)(),f=(0,p.aa)(),m=(0,p.ac)(),g=(0,i.EW)(()=>f.loading),_=(0,i.EW)(()=>f.isFetchingBalance),y=(0,l.KR)(null),h=(0,i.EW)(()=>f.lastBalanceUpdateTime?f.lastBalanceUpdateTime.toLocaleString():"");(0,i.wB)(()=>f.lastBalanceUpdateTime,(e,t)=>{e&&e!==t&&y.value&&y.value.refresh()});let b=()=>{a.showTopUpCreditsDialog()},k=async()=>{await m.accessBillingPortal()},A=()=>{a.showIssueReportDialog({title:t("issueReport.contactSupportTitle"),subtitle:t("issueReport.contactSupportDescription"),panelProps:{errorType:"BillingSupport",defaultFields:["Workflow","Logs","SystemStats","Settings"]}})},R=()=>{window.open("https://docs.comfy.org/tutorials/api-nodes/faq","_blank")},x=(0,l.KR)([]);return(e,t)=>((0,i.uX)(),(0,i.Wv)((0,l.R1)(c.A),{value:"Credits",class:"credits-container h-full"},{default:(0,i.k6)(()=>[(0,i.Lk)("div",$,[(0,i.Lk)("h2",L,(0,s.v_)(e.$t("credits.credits")),1),(0,i.bF)((0,l.R1)(d.A)),(0,i.Lk)("div",T,[(0,i.Lk)("h3",F,(0,s.v_)(e.$t("credits.yourCreditBalance")),1),(0,i.Lk)("div",D,[(0,i.bF)(p.ad,{"text-class":"text-3xl font-bold"}),g.value?((0,i.uX)(),(0,i.Wv)((0,l.R1)(u.A),{key:0,width:"2rem",height:"2rem"})):((0,i.uX)(),(0,i.Wv)((0,l.R1)(r.A),{key:1,label:e.$t("credits.purchaseCredits"),loading:g.value,onClick:b},null,8,["label","loading"]))]),(0,i.Lk)("div",S,[_.value?((0,i.uX)(),(0,i.Wv)((0,l.R1)(u.A),{key:0,width:"12rem",height:"1rem",class:"text-xs"})):h.value?((0,i.uX)(),(0,i.CE)("div",P,(0,s.v_)(e.$t("credits.lastUpdated"))+": "+(0,s.v_)(h.value),1)):(0,i.Q3)("",!0),(0,i.bF)((0,l.R1)(r.A),{icon:"pi pi-refresh",text:"",size:"small",severity:"secondary",onClick:t[0]||(t[0]=()=>(0,l.R1)(m).fetchBalance())})])]),(0,i.Lk)("div",U,[(0,i.Lk)("h3",null,(0,s.v_)(e.$t("credits.activity")),1),(0,i.bF)((0,l.R1)(r.A),{label:e.$t("credits.invoiceHistory"),text:"",severity:"secondary",icon:"pi pi-arrow-up-right",loading:g.value,onClick:k},null,8,["label","loading"])]),x.value.length>0?((0,i.uX)(),(0,i.CE)("div",I,[(0,i.bF)((0,l.R1)(o.A),{value:x.value,"show-headers":!1},{default:(0,i.k6)(()=>[(0,i.bF)((0,l.R1)(n.A),{field:"title",header:e.$t("g.name")},{body:(0,i.k6)(({data:e})=>[(0,i.Lk)("div",W,(0,s.v_)(e.title),1),(0,i.Lk)("div",X,(0,s.v_)(e.timestamp),1)]),_:1},8,["header"]),(0,i.bF)((0,l.R1)(n.A),{field:"amount",header:e.$t("g.amount")},{body:(0,i.k6)(({data:e})=>[(0,i.Lk)("div",{class:(0,s.C4)(["text-base font-medium text-center",e.isPositive?"text-sky-500":"text-red-400"])},(0,s.v_)(e.isPositive?"+":"-")+"$"+(0,s.v_)((0,l.R1)(p.ae)(e.amount,"usd")),3)]),_:1},8,["header"])]),_:1},8,["value"])])):(0,i.Q3)("",!0),(0,i.bF)((0,l.R1)(d.A)),(0,i.bF)(w,{ref_key:"usageLogsTableRef",ref:y},null,512),(0,i.Lk)("div",j,[(0,i.bF)((0,l.R1)(r.A),{label:e.$t("credits.faqs"),text:"",severity:"secondary",icon:"pi pi-question-circle",onClick:R},null,8,["label"]),(0,i.bF)((0,l.R1)(r.A),{label:e.$t("credits.messageSupport"),text:"",severity:"secondary",icon:"pi pi-comments",onClick:A},null,8,["label"])])])]),_:1}))}})}}]);
//# sourceMappingURL=6912.b7ccd44d1b736ef1.js.map